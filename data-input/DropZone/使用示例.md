# FunDropZone åœ¨ GenericResourceView ä¸­çš„ä½¿ç”¨ç¤ºä¾‹

## æ›¿æ¢ç°æœ‰çš„æ‹–æ‹½å®ç°

### ä¿®æ”¹å‰ï¼ˆå½“å‰å®ç°ï¼‰

```vue
<template>
  <div class="resource-content"
    @drop="handleDrop"
    @dragover="handleDragOver"
    @dragenter="handleDragEnter"
    @dragleave="handleDragLeave"
    :class="{ 'drag-over': isDragOver || false }">
    <div class="resources-grid">
      <!-- èµ„æºå¡ç‰‡åˆ—è¡¨ -->
    </div>
  </div>
</template>

<script setup>
import { useDragAndDrop } from '../composables/useDragAndDrop'

const dragDropComposable = useDragAndDrop({
  acceptedExtensions: [],
  enabled: true,
  onDrop: handleFileDrop
})

const handleFileDrop = async (files) => {
  // å¤„ç†æ–‡ä»¶é€»è¾‘...
}
</script>
```

### ä¿®æ”¹åï¼ˆä½¿ç”¨ FunDropZoneï¼‰

#### æ–¹æ¡ˆä¸€ï¼šåŒ…è£¹æ•´ä¸ªå†…å®¹åŒºåŸŸ

```vue
<template>
  <fun-drop-zone 
    class="resource-content"
    :accept="[]"
    :clickable="false"
    title="æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œæ·»åŠ èµ„æº"
    hint="æ”¯æŒä»»æ„ç±»å‹æ–‡ä»¶"
    drag-text="æ¾å¼€é¼ æ ‡æ·»åŠ èµ„æº"
    @drop="handleFileDrop"
    @error="handleDropError"
  >
    <template #default="{ isDragging }">
      <div class="resources-grid" :class="{ 'is-dragging': isDragging }">
        <div v-for="item in paginatedItems" :key="item.id?.value || item.id" class="resource-card">
          <MediaCard :item="item" ... />
        </div>
      </div>
    </template>
  </fun-drop-zone>
</template>

<script setup>
const handleFileDrop = async (files) => {
  try {
    console.log('[GenericResourceView] æ‹–æ‹½æ–‡ä»¶æ•°é‡:', files.length)
    
    if (files.length === 0) {
      notify.toast('error', 'æ‹–æ‹½å¤±è´¥', 'è¯·æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„')
      return
    }
    
    let addedCount = 0
    let failedCount = 0
    
    for (const file of files) {
      try {
        const filePath = (file as any).path || file.name
        
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        const existingItem = items.value.find((item) => {
          const itemPath = BaseResources.extractPrimitiveValue(
            item.resourcePath?.value || item.resourcePath
          )
          return itemPath === filePath
        })
        
        if (existingItem) {
          failedCount++
          continue
        }
        
        // åˆ›å»ºèµ„æº
        const resourceData = {
          name: extractNameFromPath(file.name),
          category: 'å…¶å®ƒ',
          resourcePath: filePath,
          resourceType: 'other',
          // ... å…¶ä»–å­—æ®µ
        }
        
        const resource = ResourceClass.fromJSON(resourceData)
        items.value.push(resource)
        addedCount++
        
      } catch (error) {
        console.error(`æ·»åŠ æ–‡ä»¶å¤±è´¥: ${file.name}`, error)
        failedCount++
      }
    }
    
    if (addedCount > 0) {
      await saveData()
      notify.toast('success', 'æ·»åŠ æˆåŠŸ', `æˆåŠŸæ·»åŠ  ${addedCount} ä¸ªèµ„æº`)
    }
    
  } catch (error) {
    console.error('[GenericResourceView] å¤„ç†æ‹–æ‹½å¤±è´¥:', error)
    notify.toast('error', 'å¤„ç†å¤±è´¥', `å¤„ç†æ‹–æ‹½æ–‡ä»¶å¤±è´¥: ${error.message}`)
  }
}

const handleDropError = (error) => {
  notify.toast('error', error.type === 'size' ? 'æ–‡ä»¶è¿‡å¤§' : 'æ–‡ä»¶ç±»å‹ä¸æ”¯æŒ', error.message)
}
</script>

<style scoped>
.resources-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: var(--spacing-xl);
  
  &.is-dragging {
    opacity: 0.5;
    pointer-events: none;
  }
}
</style>
```

#### æ–¹æ¡ˆäºŒï¼šåœ¨ç©ºçŠ¶æ€æ—¶æ˜¾ç¤º

```vue
<template>
  <div class="resource-content">
    <!-- æœ‰èµ„æºæ—¶æ˜¾ç¤ºåˆ—è¡¨ -->
    <div v-if="paginatedItems.length > 0" class="resources-grid">
      <div v-for="item in paginatedItems" :key="item.id?.value || item.id">
        <MediaCard :item="item" ... />
      </div>
    </div>
    
    <!-- ç©ºçŠ¶æ€æ—¶æ˜¾ç¤ºæ‹–æ‹½åŒºåŸŸ -->
    <fun-drop-zone 
      v-else
      class="empty-drop-zone"
      :accept="[]"
      title="æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œæ·»åŠ èµ„æº"
      hint="æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶"
      drag-text="æ¾å¼€é¼ æ ‡æ·»åŠ èµ„æº"
      @drop="handleFileDrop"
    >
      <template #default>
        <div class="empty-content">
          <div class="icon">ğŸ“</div>
          <h3>æš‚æ— èµ„æº</h3>
          <p>æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œæˆ–ç‚¹å‡»ä¸Šä¼ æŒ‰é’®æ·»åŠ èµ„æº</p>
        </div>
      </template>
    </fun-drop-zone>
  </div>
</template>

<style scoped>
.empty-drop-zone {
  min-height: 400px;
}

.empty-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  
  .icon {
    font-size: 64px;
  }
  
  h3 {
    margin: 0;
    font-size: 24px;
    color: var(--text-primary);
  }
  
  p {
    margin: 0;
    color: var(--text-secondary);
  }
}
</style>
```

#### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨æµ®åŠ¨æ‹–æ‹½åŒºåŸŸ

```vue
<template>
  <div class="resource-content">
    <!-- èµ„æºåˆ—è¡¨ -->
    <div class="resources-grid">
      <div v-for="item in paginatedItems" :key="item.id?.value || item.id">
        <MediaCard :item="item" ... />
      </div>
    </div>
    
    <!-- æµ®åŠ¨æ‹–æ‹½è¦†ç›–å±‚ -->
    <fun-drop-zone 
      class="floating-drop-zone"
      :class="{ 'is-visible': isDragging }"
      :accept="[]"
      :clickable="false"
      drag-text="æ¾å¼€é¼ æ ‡æ·»åŠ èµ„æºåˆ°å½“å‰é¡µé¢"
      @drop="handleFileDrop"
    />
  </div>
</template>

<script setup>
import { ref } from 'vue'

// ç›‘å¬å…¨å±€æ‹–æ‹½äº‹ä»¶
const isDragging = ref(false)

onMounted(() => {
  document.addEventListener('dragenter', handleGlobalDragEnter)
  document.addEventListener('dragleave', handleGlobalDragLeave)
  document.addEventListener('drop', handleGlobalDrop)
})

onBeforeUnmount(() => {
  document.removeEventListener('dragenter', handleGlobalDragEnter)
  document.removeEventListener('dragleave', handleGlobalDragLeave)
  document.removeEventListener('drop', handleGlobalDrop)
})

const handleGlobalDragEnter = () => {
  isDragging.value = true
}

const handleGlobalDragLeave = (e) => {
  if (!e.relatedTarget) {
    isDragging.value = false
  }
}

const handleGlobalDrop = () => {
  isDragging.value = false
}
</script>

<style scoped>
.floating-drop-zone {
  position: fixed;
  inset: 0;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  
  &.is-visible {
    opacity: 1;
    pointer-events: auto;
  }
}
</style>
```

## é’ˆå¯¹ä¸åŒèµ„æºç±»å‹çš„é…ç½®

### æ¸¸æˆèµ„æº

```vue
<fun-drop-zone 
  :accept="['.exe', '.swf', '.bat', '.zip', '.rar', '.7z']"
  title="æ·»åŠ æ¸¸æˆ"
  hint="æ”¯æŒæ‹–æ‹½æ¸¸æˆå¯æ‰§è¡Œæ–‡ä»¶æˆ–å‹ç¼©åŒ…"
  drag-text="æ¾å¼€æ·»åŠ æ¸¸æˆåˆ°åº“ä¸­"
  :max-size="5 * 1024 * 1024 * 1024"
  @drop="handleFileDrop"
/>
```

### å›¾ç‰‡èµ„æº

```vue
<fun-drop-zone 
  :accept="['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp']"
  title="æ·»åŠ å›¾ç‰‡"
  hint="æ”¯æŒ JPGã€PNGã€GIF ç­‰æ ¼å¼"
  @drop="handleFileDrop"
/>
```

### è§†é¢‘èµ„æº

```vue
<fun-drop-zone 
  :accept="['.mp4', '.avi', '.mov', '.wmv', '.flv', '.mkv']"
  title="æ·»åŠ è§†é¢‘"
  hint="æ”¯æŒå¸¸è§è§†é¢‘æ ¼å¼"
  :max-size="2 * 1024 * 1024 * 1024"
  @drop="handleFileDrop"
/>
```

### éŸ³é¢‘èµ„æº

```vue
<fun-drop-zone 
  :accept="['.mp3', '.wav', '.flac', '.aac', '.ogg']"
  title="æ·»åŠ éŸ³é¢‘"
  hint="æ”¯æŒå¸¸è§éŸ³é¢‘æ ¼å¼"
  @drop="handleFileDrop"
/>
```

### æ–‡æ¡£èµ„æº

```vue
<fun-drop-zone 
  :accept="['.pdf', '.doc', '.docx', '.txt', '.md']"
  title="æ·»åŠ æ–‡æ¡£"
  hint="æ”¯æŒ PDFã€Wordã€æ–‡æœ¬æ–‡ä»¶"
  @drop="handleFileDrop"
/>
```

### å…¶å®ƒèµ„æºï¼ˆæ— é™åˆ¶ï¼‰

```vue
<fun-drop-zone 
  :accept="[]"
  title="æ·»åŠ èµ„æº"
  hint="æ”¯æŒä»»æ„ç±»å‹æ–‡ä»¶"
  @drop="handleFileDrop"
/>
```

## ä¼˜åŠ¿å¯¹æ¯”

### ä½¿ç”¨ FunDropZone çš„ä¼˜åŠ¿

âœ… **æ›´å¥½çš„å°è£…æ€§**
- æ‹–æ‹½é€»è¾‘å®Œå…¨å°è£…åœ¨ç»„ä»¶å†…éƒ¨
- ä¸éœ€è¦æ‰‹åŠ¨ç»‘å®šäº‹ä»¶å¤„ç†å™¨
- ä¸éœ€è¦ç®¡ç†æ‹–æ‹½çŠ¶æ€

âœ… **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**
- ç»Ÿä¸€çš„æ‹–æ‹½è¡Œä¸º
- æ˜“äºæ›´æ–°å’Œä¿®æ”¹
- ä»£ç æ›´ç®€æ´

âœ… **æ›´å¼ºå¤§çš„åŠŸèƒ½**
- å†…ç½®æ–‡ä»¶éªŒè¯ï¼ˆç±»å‹ã€å¤§å°ã€æ•°é‡ï¼‰
- æ”¯æŒç‚¹å‡»ä¸Šä¼ 
- è‡ªå®šä¹‰æ’æ§½
- é”™è¯¯å¤„ç†

âœ… **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ**
- ç»Ÿä¸€çš„è§†è§‰åé¦ˆ
- æ›´å¥½çš„åŠ¨ç”»æ•ˆæœ
- æ›´æ¸…æ™°çš„æç¤ºä¿¡æ¯

âœ… **æ›´æ˜“äºå¤ç”¨**
- å¯åœ¨å¤šä¸ªé¡µé¢ä½¿ç”¨
- é…ç½®çµæ´»
- é€‚ç”¨äºä¸åŒèµ„æºç±»å‹
